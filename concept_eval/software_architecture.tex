% !TEX root = main.tex

\pagebreak
\section{Software Architecture}
\label{sec:software_architecture}
The software architecture can be separated into three sections: image processing, work planning and distribution, and communication between robot onboard systems and the central offboard system. These systems are described below.

\subsection{Image Processing}
\label{sec:sw_arch_image_processing}

\begin{figure}[h!]
 \centering
  \includegraphics[width=0.99\columnwidth]{diagrams/sw_arch_image_processing.jpg}
	\caption{Image Processing Software Pipeline}
 \label{fig:image_processing}
\end{figure}

The image processing pipeline (\figref{fig:image_processing}) takes the image scanned by the user, and parses it into a form readable by the work planner. The goal of this software system is to create a series of lines that describes the image. To do this, the system first creates an occupancy grid of the input via voxelization. For a black and white image, the occupancy grid determines black or white. In the case of color, voxels are assigned color based on the image values inside of the voxel.

Once voxelization is complete, lines are formed from the voxels through a nearest-neighbor search. These lines are simply a series of voxel squares that pass through the image. In order to preserve curvature of lines from the input, the grid-delineated lines are reparamterized with splines into paths. These paths are then sent to the work planning module.

\subsection{Communication}
\label{sec:sw_arch_communication}

\begin{figure}[h!]
 \centering
  \includegraphics[width=0.99\columnwidth]{diagrams/sw_arch_communication.jpg}
	\caption{Communication Software Pipeline}
 \label{fig:comm_processing}
\end{figure}

The communication diagram (\figref{fig:comm_processing}) describes how an individual robot communicates with the offboard path planning system. The system can be described by communciation in four categories: motion commands, writing tool commands, error handling, and localization.

The offboard system will use the planning algorithm to determine motion plans for the robot systems. It determines and then sends velocity commands to the onboard system. The onboard system passes these commands to the drive motors for motion.

To command the writing tool, the offboard system also decides how to move the writing implement based on localization of the robot systems. Similar to velocity commands, the onboard system receives commands for the writing tool, and commands the system accordingly.

Localization receives input from the sensor module, and computes position and orientation. This data is then sent back to the central offboard module to update planning and scheduling.

Error logs are generated by the offboard system based on localization and planning, and sent to each robot's onboard system for appropriate reaction. This includes the emergency stop, which will immediately shut down writing tool and drive motors.

\subsection{Work Scheduling, Distribution and Planning}
\label{sec:sw_arch_planner}

\begin{figure}[h!]
 \centering
  \includegraphics[width=0.99\columnwidth]{diagrams/sw_arch_planning.jpg}
	\caption{Planning and Scheduling Software Pipeline}
 \label{fig:planning_processing}
\end{figure}


\rhnote{Describe planning diagram}